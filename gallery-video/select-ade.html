<!DOCTYPE html>
<!--
 *  This file is part of jsFractalZoom - Fractal zoomer written in javascript
 *
 *  Copyright (C) 2018, xyzzy@rockingship.org
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published
 *  by the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>ADE PPF selector (contains flashing white lights)</title>
	<link rel="preload" href="https://rockingship.org/jsFractalZoom/gallery-video/ade-preview.jpg" as="image">
	<style>
		body {
			font-family: Verdana, Geneva, sans-serif;
			position: relative;
			margin: 0;
			padding: .5em;
			line-height: 1.2em;
		}

		h1 {
			text-align: center;
		}

		img {
			border: .1em solid silver;
			margin: .2em;
			width: 48%;
			height: auto;
		}

		#idPreviewWrapper {
			position: relative;
			width: 100%;
			text-align: center;
		}

		.mono {
			font-family: monospace, serif;
			white-space: nowrap;
		}

		.row {
			width: 100%;
			text-align: center;
		}

		.rowDescription {
			display: inline-block;
			width: 6em;
			text-align: center;
			white-space: nowrap;
		}

		.rowDescription2 {
			display: inline-block;
			width: 12em;
			text-align: center;
			white-space: nowrap;
		}

		#idPopupWrapperLeft, #idPopupWrapperRight {
			position: absolute;
			margin: auto;
			top: 0;
			bottom: 0;
			width: 50%;
			height: 4.8em; /* 1.2 lineHeight + 2* 0.1em border + 2* 0.5em padding @ 2em fontSize */
			text-align: center;
			pointer-events: none;
		}

		#idPopupWrapperLeft {
			left: 0;
		}

		#idPopupWrapperRight {
			right: 0;
		}

		#idPopupLeft, #idPopupRight {
			opacity: 0;
			display: inline-block;
			padding: 0.5em;
			border: .1em solid #fff;
			border-radius: .5em;
			background-color: #000;
			font-size: 2em;
			color: #fff;
			transition: opacity 0.6s;
			pointer-events: none;
			white-space: nowrap;
		}

		#idPopupLeft.active, #idPopupRight.active {
			opacity: 1;
		}

	</style>
</head>
<body>

<div id="idPreviewWrapper">
	<img id="idLeft" src="https://rockingship.org/jsFractalZoom/gallery-video/ade-preview.jpg" width="900" height="506">
	<div id="idPopupWrapperLeft">
		<div id="idPopupLeft">Loading</div>
	</div>
	<img id="idRight" src="https://rockingship.org/jsFractalZoom/gallery-video/ade-preview.jpg" width="900" height="506">
	<div id="idPopupWrapperRight">
		<div id="idPopupRight">Loading</div>
	</div>
</div>

<div class="row">
	<button onclick="loadLeft(event, 'ade-1')">L</button>
	<span class="rowDescription">1:1</span>
	<span class="rowDescription">[900x506]</span>
	<button onclick="loadRight(event, 'ade-1')">R</button>
</div>
<div class="row">
	<button onclick="loadLeft(event, 'ade-2')">L</button>
	<span class="rowDescription">1:2</span>
	<span class="rowDescription">[636x358]</span>
	<button onclick="loadRight(event, 'ade-2')">R</button>
</div>
<div class="row">
	<button onclick="loadLeft(event, 'ade-5')">L</button>
	<span class="rowDescription">1:5</span>
	<span class="rowDescription">[402x226]</span>
	<button onclick="loadRight(event, 'ade-5')">R</button>
</div>
<div class="row">
	<button onclick="loadLeft(event, 'ade-10')">L</button>
	<span class="rowDescription">1:10</span>
	<span class="rowDescription">[285x160]</span>
	<button onclick="loadRight(event, 'ade-10')">R</button>
</div>
<div class="row">
	<button onclick="loadLeft(event, 'ade-20')">L</button>
	<span class="rowDescription">1:20</span>
	<span class="rowDescription">[201x113]</span>
	<button onclick="loadRight(event, 'ade-20')">R</button>
</div>
<div class="row">
	<button onclick="loadLeft(event, 'ade-50')">L</button>
	<span class="rowDescription">1:50</span>
	<span class="rowDescription">[127x72]</span>
	<button onclick="loadRight(event, 'ade-50')">R</button>
</div>
<div class="row">
	<button onclick="loadLeft(event, 'ade-100')">L</button>
	<span class="rowDescription">1:100</span>
	<span class="rowDescription">[90x50]</span>
	<button onclick="loadRight(event, 'ade-100')">R</button>
</div>
<div class="row">
	<button onclick="loadLeft(event, 'ade-150')">L</button>
	<span class="rowDescription">1:150</span>
	<span class="rowDescription">[73x41]</span>
	<button onclick="loadRight(event, 'ade-150')">R</button>
</div>
<div class="row">
	<button onclick="loadLeft(event, 'ade-300')">L</button>
	<span class="rowDescription">1:300</span>
	<span class="rowDescription">[52x29]</span>
	<button onclick="loadRight(event, 'ade-300')">R</button>
</div>
<div class="row">
	<button onclick="loadLeft(event, 'ade-600')">L</button>
	<span class="rowDescription">1:600</span>
	<span class="rowDescription">[37x21]</span>
	<button onclick="loadRight(event, 'ade-600')">R</button>
</div>
<div class="row">
	<button onclick="loadLeft(event, 'ade-900')">L</button>
	<span class="rowDescription">1:900</span>
	<span class="rowDescription">[30x17]</span>
	<button onclick="loadRight(event, 'ade-900')">R</button>
</div>
<div class="row">
	<button onclick="loadLeft(event, 'ade-1200')">L</button>
	<span class="rowDescription">1:1200</span>
	<span class="rowDescription">[26x15]</span>
	<button onclick="loadRight(event, 'ade-1200')">R</button>
</div>
<div class="row">
	<button onclick="loadLeft(event, 'ade-1600')">L</button>
	<span class="rowDescription">1:1600</span>
	<span class="rowDescription">[23x13]</span>
	<button onclick="loadRight(event, 'ade-1600')">R</button>
</div>
<div class="row">
	<button onclick="loadLeft(event, 'ade-2000')">L</button>
	<span class="rowDescription">1:2000</span>
	<span class="rowDescription">[20x11]</span>
	<button onclick="loadRight(event, 'ade-2000')">R</button>
</div>
<div class="row">
	<button onclick="loadLeft(event,'ade-2400')">L</button>
	<span class="rowDescription">1:2400</span>
	<span class="rowDescription">[18x10]</span>
	<button onclick="loadRight(event, 'ade-2400')">R</button>
</div>
<div class="row">
	<button onclick="loadLeft(event,'ade-285x160-420x236')">L</button>
	<span class="rowDescription2">Upscaled 285x160</span>
	<button onclick="loadRight(event, 'ade-285x160-420x236')">R</button>
</div>
<div class="row">
	<button onclick="loadLeft(event,'ade-90x50-420x236')">L</button>
	<span class="rowDescription2">Upscaled 90x50</span>
	<button onclick="loadRight(event, 'ade-90x50-420x236')">R</button>
</div>

<h1>Comparing ADE with different PixelPerFrame settings</h1>
<p style="text-align:center; font-weight: bold">(contains flashing white lights)</p>
<p>Above is an overview of available clips with different PPF settings. Press "L"/"R" to load them into the preview areas above.</p>
<p>Suggested combos: <span class="mono">"1:100 <-> 1:900"</span>, <span class="mono">"1:10 <-> upscaled 285x160"</span> and <span class="mono">"1:100 <-> upscaled 90x50"</span></p>
<p>Both previews should be in sync (buttons are green). If out of sync after loading press button again.</p>

<p>This clip was chosen because it has fast and abrupt movements which stresses low bandwidth settings. Audio has been removed to reduce ear stress.</p>
<p>The original 900x506 source with audio: <a href="https://rockingship.org/jsFractalZoom/gallery-video/ade-orig.mp4"><span class="mono">ade-orig.mp4</span></a> is not extreme high quality and most likely not show differences with high bandwidth settings.</p>
<p>A PPF unit is the fraction of total original frame pixels. A PPF of 1:150 means that the frame consists of 0.66% (=1/150) source pixels. The remaining 99.33% (=149/150) is procedurally filled.</p>
<p>The HxW in brackets is the equivalent image size to match the same number of pixels as the PPF setting.</p>

<p>Areas of interest:</p>
<dl>
	<dt>Dashboard</dt>
	<dd>The pixel splash is taking advantage of the gradient colouring.</dd>
	<dt>Yellow dial lights</dt>
	<dd>The brightness punches the scanline scoring causing it to be rendered first and sharp.</dd>
	<dt>Lights in rear mirror</dt>
	<dd>Balance between less abrupt movements and different sizes of head lights stress blurring of splash effect.</dd>
	<dt>Roof</dt>
	<dd>Extreme low amount of changes prolong updates which stresses ghosting, dithering and colour shading.</dd>
</dl>

<script type="text/javascript">
	"use strict";

	window.addEventListener("load", function () {

		const imgLeft = document.getElementById("idLeft");
		const imgRight = document.getElementById("idRight");
		const popupLeft = document.getElementById("idPopupLeft");
		const popupRight = document.getElementById("idPopupRight");
		const splashImage = "https://rockingship.org/jsFractalZoom/gallery-video/ade-preview.jpg";
		let leftImage = null;
		let rightImage = null;
		let leftButton = null;
		let rightButton = null;
		let leftTick = 0;
		let rightTick = 0;
		let leftTimer = null;
		let rightTimer = null;

		imgLeft.addEventListener("load", function () {
			if (imgLeft.src === splashImage && leftImage) {
				imgLeft.src = leftImage;
				leftTick = performance.now() + 200;
			} else if (leftButton) {
				clearTimeout(leftTimer);
				popupLeft.className = "";
				if (!rightButton || leftTick >= performance.now())
					leftButton.style.backgroundColor = "lightgreen";
			}
		});

		imgRight.addEventListener("load", function () {
			if (imgRight.src === splashImage && rightImage) {
				imgRight.src = rightImage;
				rightTick = performance.now() + 200;
			} else if (rightButton) {
				clearTimeout(rightTimer);
				popupRight.className = "";
				if (!leftButton || rightTick >= performance.now())
					rightButton.style.backgroundColor = "lightgreen";
			}
		});

		window.loadLeft = (event, leftName) => {
			// colouring
			if (leftButton)
				leftButton.style.backgroundColor = "";
			leftButton = event.target;
			if (leftButton) {
				leftButton.style.backgroundColor = "orange";
				// wait 100 mSec before showing popup
				leftTimer = setTimeout(() => {
					popupLeft.className = "active";
				}, 500);
			}

			// new image name
			leftImage = "https://rockingship.org/jsFractalZoom/gallery-video/" + leftName + ".webp";

			// should load within 100mSec
			leftTick = performance.now() + 100;

			// remove source so that animation stops. Event listeners will start animation
			imgLeft.src = splashImage;
			imgRight.src = splashImage;
		};

		window.loadRight = (event, rightName) => {
			// colouring
			if (rightButton)
				rightButton.style.backgroundColor = "";
			rightButton = event.target;
			if (rightButton) {
				rightButton.style.backgroundColor = "orange";
				// wait 100 mSec before showing popup
				rightTimer = setTimeout(() => {
					popupRight.className = "active";
				}, 500);
			}

			// new image name
			rightImage = "https://rockingship.org/jsFractalZoom/gallery-video/" + rightName + ".webp";

			// should load within 100mSec
			rightTick = performance.now() + 100;

			// remove source so that animation stops. Event listeners will start animation
			imgLeft.src = splashImage;
			imgRight.src = splashImage;
		};
	});

</script>
</body>
</html>
